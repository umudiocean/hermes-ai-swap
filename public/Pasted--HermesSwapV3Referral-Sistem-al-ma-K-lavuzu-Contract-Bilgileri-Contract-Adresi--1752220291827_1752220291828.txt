# 🚀 HermesSwapV3Referral Sistem Çalışma Kılavuzu

## 📋 Contract Bilgileri
- **Contract Adresi:** `0x040c821072fB0db013453329DcC78aB433d19a31`
- **Contract Adı:** `HermesSwapV3Referral`
- **Network:** BSC Mainnet
- **EVM Version:** Cancun

---

## 💰 Yeni Ödül Sistemi

### 🎯 Referans OLMADAN Swap:
```
Kullanıcı → Swap yapar
Platform → 100,000 HERMES verir
Sonuç: 100,000 HERMES (eski sistem ile aynı)
```

### 🤝 Referans İLE Swap (YENİ!):
```
Kullanıcı → Referans kodu ile swap yapar
Platform → Toplam 120,000 HERMES havuzundan:
├── Kullanıcı: 110,000 HERMES alır
└── Referans Sahibi: 10,000 HERMES alır

Toplam Dağıtım: 120,000 HERMES
```

---

## 🔄 Swap İşlem Akışı

### 1. **Fee İşlemi (Her Swap'te)**
```
Kullanıcı → 0.0005 BNB gönderir
Platform → Fee'yi otomatik şu adrese transfer eder:
           0xd88026A648C95780e3056ed98eD60E5105cc4863
```

### 2. **Token Swap İşlemi**
```
PancakeSwap Router üzerinden swap gerçekleşir:
- BNB ↔ Token
- Token ↔ Token
- Tüm fee-on-transfer tokenlar desteklenir
```

### 3. **Ödül Dağıtımı**
```
IF (referral kodu var ve geçerli)
    Contract → Kullanıcıya 110,000 HERMES
    Contract → Referans sahibine 10,000 HERMES
ELSE
    Contract → Kullanıcıya 100,000 HERMES
```

---

## 🎫 Referans Sistemi Detayları

### Referans Kodu Oluşturma:
```solidity
generateReferralCode() → uint256 (kod numarası)
```
- Her kullanıcı **1 kez** kod oluşturabilir
- Kod numaraları **1000**'den başlar
- Sistem otomatik artırır: 1000, 1001, 1002...

### Referans Kullanımı:
```solidity
swap(tokenIn, tokenOut, amount, referralCode)
```

#### Geçerlilik Koşulları:
✅ Referral kod > 0 olmalı  
✅ Kod daha önce oluşturulmuş olmalı  
✅ Kod sahibi swap yapan kişi olmamalı  

---

## 🔧 Ana Fonksiyonlar

### **Swap Fonksiyonu**
```solidity
function swap(
    address tokenIn,     // Gönderilecek token (0x0 = BNB)
    address tokenOut,    // Alınacak token (0x0 = BNB)
    uint256 amountIn,    // Miktar (BNB swap'lerde 0)
    uint256 referralCode // Referans kodu (0 = yok)
) external payable
```

### **Referans Kodu Oluşturma**
```solidity
function generateReferralCode() external returns (uint256)
```

### **Hızlı Swap Fonksiyonları**
```solidity
swapBNBToHERMES(referralCode)   // BNB → HERMES
swapHERMESToBNB(amount, referralCode) // HERMES → BNB
```

---

## 📊 View Fonksiyonları

### **Kullanıcı Bilgileri**
```solidity
getReferralCode(address user) → uint256
getReferralStats(address user) → (code, earnings, totalRefs, hasCode)
```

### **Platform Bilgileri**
```solidity
getContractInfo() → (
    hermesBalance,      // Contract'taki HERMES miktarı
    bnbBalance,         // Contract'taki BNB miktarı
    swapCount,          // Toplam swap sayısı
    rewardsDistributed, // Dağıtılan toplam HERMES
    feesCollected,      // Toplanan toplam fee
    referralRewardsTotal, // Referans ödülleri toplamı
    canReward           // Ödül verebilir mi?
)
```

### **Fiyat Tahmini**
```solidity
estimateSwap(tokenIn, tokenOut, amountIn) → estimatedOut
```

---

## 💡 Kullanım Örnekleri

### Örnek 1: İlk Kullanıcı (Referans Yok)
```
1. User: generateReferralCode() → 1000 döner
2. User: swap(BNB, USDT, 0, 0) 
   - 0.001 BNB gönderir (0.0005 fee + swap için)
3. Platform: 0.0005 BNB fee'yi collector'a gönderir
4. PancakeSwap: 0.0005 BNB → USDT swap
5. Platform: 100,000 HERMES → User
```

### Örnek 2: Referans ile Swap
```
1. UserA: generateReferralCode() → 1001 döner
2. UserB: swap(USDT, BNB, 100, 1001)
   - 0.0005 BNB fee gönderir
   - 100 USDT approve eder
3. Platform: Fee'yi collector'a gönderir
4. PancakeSwap: 100 USDT → BNB swap
5. Platform: 110,000 HERMES → UserB
6. Platform: 10,000 HERMES → UserA (referans sahibi)
```

### Örnek 3: HERMES Alım/Satım
```
// HERMES Alımı
swapBNBToHERMES(1001) 
- BNB → HERMES + referans ödülü

// HERMES Satımı  
swapHERMESToBNB(50000 * 10**18, 1001)
- 50,000 HERMES → BNB + referans ödülü
```

---

## ⚡ Teknik Detaylar

### Gas Optimizasyonu:
- **Cancun EVM** en güncel optimizasyonlar
- **Fee-on-transfer** token desteği
- **Batch işlemler** tek transaction'da

### Güvenlik Özellikleri:
- **Automatic fee transfer** (swap öncesi)
- **Balance validation** her adımda
- **Referral validation** çift kontrol
- **Owner-only** emergency functions

### Swap Rotaları:
```
BNB ↔ Token: Direkt yol (2 adım)
Token A ↔ Token B: BNB üzerinden (3 adım)
- Token A → WBNB → Token B
```

---

## 📈 Ekonomik Model

### Platform Geliri:
```
Her Swap = 0.0005 BNB fee
↓
Otomatik Transfer: 0xd88026A648C95780e3056ed98eD60E5105cc4863
```

### Ödül Havuzu:
```
Referans YOK: 100,000 HERMES/swap
Referans VAR: 120,000 HERMES/swap (20% artış!)
```

### Referans Incentive:
```
Kullanıcı Kazancı: 110,000 HERMES (10% artış)
Referans Sahibi: 10,000 HERMES (pasif gelir)
```

---

## 🔧 Admin Fonksiyonları

### HERMES Yükleme:
```solidity
depositRewards(amount) // HERMES token yükle
```

### Acil Durum:
```solidity
emergencyWithdrawBNB() // Owner only
withdrawToken(token, amount) // Owner only
```

---

## 🎯 İstatistikler ve Tracking

### Global İstatistikler:
- `totalSwaps` - Toplam swap sayısı
- `totalRewardsDistributed` - Dağıtılan HERMES toplamı
- `totalFeesCollected` - Toplanan BNB fee toplamı
- `totalReferralRewards` - Referans ödülleri toplamı

### Kullanıcı İstatistikleri:
- `referralEarnings[user]` - Kullanıcının referans kazancı
- `totalReferrals[user]` - Kullanıcının referans sayısı

---

## 🚨 Önemli Notlar

### HERMES Token Yönetimi:
- Contract'a yeterli HERMES yüklenmeli
- Referans swap'leri için **120,000 HERMES** gerekli
- Normal swap'ler için **100,000 HERMES** gerekli

### Fee Gereksinimleri:
- **Her swap** minimum 0.0005 BNB gerektirir
- Fee transfer başarısız olursa **tüm işlem iptal** olur
- Kalan BNB swap için kullanılır

### Referans Limitleri:
- Kullanıcı **kendi kodunu kullanamaz**
- Her kullanıcı **sadece 1 kod** oluşturabilir
- Geçersiz kod durumunda **normal ödül** (100k) verilir

---

## 🌟 Yeni Sistemin Avantajları

### Kullanıcılar İçin:
✅ **%10 daha fazla ödül** (90k → 110k HERMES)  
✅ **Referans geliri** (10k HERMES/referans)  
✅ **Aynı platform fee** (0.0005 BNB)  

### Platform İçin:
✅ **%20 daha fazla token dağıtımı** (virality)  
✅ **Güçlü referral sistemi** (user acquisition)  
✅ **Stabil gelir** (her swap'te fee)  

---

## 📞 Web3 Integration Örneği

```javascript
// Contract instance
const contract = new web3.eth.Contract(ABI, CONTRACT_ADDRESS);

// Referral kod oluştur
const referralCode = await contract.methods.generateReferralCode().send({
    from: userAddress
});

// Referral ile swap yap
await contract.methods.swap(
    tokenInAddress,   // Input token
    tokenOutAddress,  // Output token  
    amountIn,         // Amount
    referralCode      // Referral code
).send({
    from: userAddress,
    value: web3.utils.toWei('0.0005', 'ether') // Fee
});

// Kullanıcı stats al
const stats = await contract.methods.getReferralStats(userAddress).call();
console.log(`Kazanç: ${stats.earnings} HERMES`);
console.log(`Referans sayısı: ${stats.totalRefs}`);
```

---

Bu yeni sistem sayesinde hem kullanıcılar daha fazla ödül kazanacak, hem de referans sistemi ile platform organik olarak büyüyecek! 🚀